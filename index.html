<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>Sboot Up!</title>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">

    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">

    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <script type="application/javascript">
        function getFormData($form){
            var unindexed_array = $form.serializeArray();
            var indexed_array = {};

            $.map(unindexed_array, function(n, i){
                indexed_array[n['name']] = n['value'];
            });

            return indexed_array;
        }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="droppable">
        <div id="droppable">
          <p>Drop here</p>
        </div>
      </div>
      <div class="row">
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
          Launch demo modal
        </button>

        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
              </div>
              <div class="modal-body">
                <form id="entity-form">
                  <div id="counterProps" class="0" style="display: none"></div>
                  <div class="form-inline">
                    <div class="form-group">
                      <label for="entity-singlular">Singolare</label>
                      <input type="text" class="form-control" id="entity-singlular" name="entity[name]" placeholder="persona, casa, indirizzo...">
                    </div>
                    <div class="form-group">
                      <label for="entity-plural">Plurale</label>
                      <input type="text" class="form-control" id="entity-plural" name="entity[collection]" placeholder="persone, case, indirizzi...">
                    </div>
                  </div>
                  <hr>
                  <button id="aggiungi-proprieta" type="button" class="btn btn">Aggiungi proprietà</button>
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Proprieta</th>
                        <th>Tipo</th>
                        <th>PK</th>
                        <th>x</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr id="line_0">
                        <td><span class="form-group"><input type="text" name="entity[property0][name]" class="form-control" placeholder="nome, civico, data di nascita"></span></td>
                        <td><span class="form-group"><select name="entity[property0][type]" class="form-control">
                        <option>String</option>
                        <option>Integer</option>
                        <option>Long</option>
                        <option>Double</option>
                        <option>Date</option>
                      </select>
                    </span></td>
                        <td><span class="form-group"><input id="cb_0" name="entity[property0][pk]" class="pk-indicator" type="checkbox"></span></td>
                        <td><span id="lr_0" class="glyphicon glyphicon-remove line-remover"></span></td>
                      </tr>
                    </tbody>
                  </table>

                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" id="entity-form-reset">Reset</button>
                <button type="button" class="btn btn-primary" id="entity-form-confirm">Conferma</button>
              </div>
            </div>
          </div>
        </div>
      </div><!-- chiude .row definizione entità -->

      <div class="row">
        <div class="col-lg-3 tier-container">

          <div class="presentation-tier-title x-tier-title">
            <h2>Presentation</h2>
          </div>

          <div class="presentation-tier-container x-tier-container" style="background-color: red">

            <div class="thymeleaf-container tech-container">
              <div id="thymeleaf" class="draggable">
                <img src="assets/thymeleaf.png" width="55">
              </div>
              <div>
                <h4>RESTful MVC</h4>
                <p>Crea una struttura per CRUD completamente REST</p>
              </div>
            </div><!-- chiude .thymeleaf-container -->

            <div class="angular-container tech-container">
              <div id="angular" class="draggable">
                <img src="assets/angular.svg" width="65">
              </div>
              <div>
                <h4>Angular</h4>
                <p>Genera un'applicazione Angular per il browser</p>
              </div>
            </div><!-- chiude .thymeleaf-container -->

          </div><!-- chiude .presentation-tier-container -->

        </div><!-- chiude .tier-container -->
        <div class="col-lg-6 tier-container">
          <div class="business-tier-title x-tier-title">
            <h2>Business</h2>
          </div>
          <div class="business-tier-container x-tier-container" style="background-color: yellow">

            <div class="sub-business-container">

              <div class="ext-business-container internal-business-container">

                <div class="springmvc-container tech-container">
                  <div id="springmvc" class="draggable">
                    <img src="assets/spring.png" width="65">
                  </div>
                  <div>
                    <h4>RESTful MVC</h4>
                    <p>Crea una struttura per CRUD completamente REST</p>
                  </div>
                </div><!-- chiude .springmvc-container -->

                <div class="swagger-container tech-container">
                  <div id="swagger" class="draggable">
                    <img src="assets/swagger.png" width="65">
                  </div>
                  <div>
                    <h4>Open API</h4>
                    <p>Genera una API aderente agli standard Open API</p>
                  </div>
                </div><!-- chiude .swagger-container -->

              </div><!-- chiude .ext-business-container -->

            </div><!-- chiude .sub-business-container > .ext-business-container -->

            <div class="sub-business-container">

              <div class="int-business-container internal-business-container">

                <div class="service-container tech-container">
                  <div id="service" class="draggable">
                    <img src="assets/services.png" width="65">
                  </div>
                  <div>
                    <h4>Business Logic</h4>
                    <p>Genera solo uno stack di classi per la gestione della BL</p>
                  </div>
                </div><!-- chiude .service-container -->

                <div class="conversion-container tech-container">
                  <div id="convertion" class="draggable">
                    <img src="assets/convertion.png" width="65">
                  </div>
                  <div>
                    <h4>DTO Convertion</h4>
                    <p>Crea esclusivamente la struttura DTO a supporto della persistenza</p>
                  </div>
                </div><!-- chiude .convertion-container -->

              </div><!-- chiude .int-business-container -->

            </div><!-- chiude .sub-business-container > .int-business-container -->
            <div style="clear: both"> </div>
          </div>
        </div>

        <div class="col-lg-3 tier-container">

          <div class="presentation-tier-title x-tier-title">
            <h2>Persistence</h2>
          </div>

          <div class="persistence-tier-container x-tier-container" style="background-color: green">

            <div class="jpa-container tech-container">
              <div id="hibernate" class="draggable">
                <img src="assets/hibernate.png" width="65">
              </div>
              <div>
                <h4>Hibernate</h4>
                <p>Genera Entity e Repository in standard JPA con Hibernate</p>
              </div>
            </div><!-- chiude .jpa-container -->

          </div><!-- chiude .x-tier-container -->
        </div>
      </div>

      <div class="row">
        <div class="col-lg-12">
          <h1 id="finalCommand"></h1>
        </div>
      </div>

    </div><!-- chiude .container -->
    <script>
      $(document).ready(function() {
          var lines = 1;

          $("#droppable").droppable({
              drop: function() {
                  alert( "dropped" );
              }
          });
          $( ".draggable" ).draggable({ helper: "clone" });

          $('#aggiungi-proprieta').on('click', function(){
              $('#entity-form table tbody').append('<tr id="line_'+lines+'">'+
                  '<td><span class="form-group"><input type="text" name="entity[property'+lines+'][name]" class="form-control" placeholder="nome, civico, data di nascita"></span></td>'+
                  '<td><span class="form-group"><select name="entity[property'+lines+'][type]" class="form-control">'+
                  '<option>String</option>'+
                  '<option>Integer</option>'+
                  '<option>Long</option>'+
                  '<option>Double</option>'+
                  '<option>Date</option>'+
                  '</select>'+
                  '</span></td>'+
                  '<td><span class="form-group"><input id="cb_'+lines+'" name="entity[property'+lines+'][pk]" class="pk-indicator" type="checkbox"></span></td>'+
                  '<td><span id="lr_'+lines+'" class="glyphicon glyphicon-remove line-remover"></span></td>');
              $('#counterProps').addClass(''+lines+'');
              lines ++;
          });

          $('#entity-form table tbody').on('click','tr .line-remover',function(){
              var r = $(this).prop('id').split('_')[1];
              $(this).parent().parent().remove();
              $('#counterProps').removeClass(r);
          });

          $('#entity-form table tbody').on('click','input[type="checkbox"].pk-indicator',function(e) {
              var _this = $(this);
              var a = $('form table tbody tr input[type="checkbox"].pk-indicator:checked');
              for(var i=0;i<a.length;i++){
                  var _item = $(a[i]);
                  if(_item.prop('id') != _this.prop('id')){
                    _item.prop('checked', false);
                  }
              }
          });

          $('#entity-form-reset').on('click',resetForm);

          function resetForm(){
              $('#entity-form')[0].reset();
              var ep = $('#counterProps').prop('class').split(' ').slice(1);
              for(var i=0; i<ep.length;i++){
                  $('#line_'+ep[i]).remove();
                  $('#counterProps').removeClass(ep[i]);
              }
          }


          $('#entity-form-confirm').on('click',function(){
              var str = produceEntityOutput();
              $('#finalCommand').text(str);
          });

          function checkEmptiness(prop){
              var formObj = getFormData($('#entity-form'));
              return !formObj[prop].trim();
          }

          function produceEntityOutput(){

              var formObj = getFormData($('#entity-form'));
              if(!checkEmptiness("entity[name]")){
                  var str = "";
                  str += formObj['entity[name]'];
                  if(!checkEmptiness('entity[collection]')){
                      str += ":"+formObj['entity[collection]'];
                  }
              }

              var properties = $('#counterProps').prop('class').split(' ');

              for(var i=0; i<properties.length; i++){
                  if(!checkEmptiness('entity[property'+properties[i]+'][name]')){
                      str += " "+formObj['entity[property'+properties[i]+'][name]']+":"+formObj['entity[property'+properties[i]+'][type]'];
                      if(formObj['entity[property'+properties[i]+'][pk]'] == "on"){
                          str += ":pk";
                      }
                  }
              }

              return str;
          }


      });


    </script>
  </body>
</html>
